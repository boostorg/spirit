sudo: false

language: cpp

matrix:
  include:
    - os: linux
      addons:
        apt:
          packages:
            - g++-7
          sources:
            - ubuntu-toolchain-r-test
      compiler: g++-7
      script: b2 -j3 libs/spirit/test/x3 toolset=gcc-7 cxxstd=14

    - os: linux
      addons:
        apt:
          packages:
            - clang++-5.0
            - libc++-dev
          sources:
            - llvm-toolchain-trusty-5.0
      compiler: clang++-5.0
      script: b2 -j3 libs/spirit/test/x3 toolset=clang-5.0 cxxstd=14 cxxflags="-stdlib=libc++" linkflags="-stdlib=libc++"

    - os: osx
      compiler: clang++
      script: b2 -j3 libs/spirit/test/x3 toolset=clang cxxstd=14

install:
  - cd ..
  - git clone -b develop --depth 1 https://github.com/boostorg/boost.git boost-root
  - cd boost-root
  - export BOOST_ROOT="`pwd`"
  - export PATH="`pwd`":$PATH

  - git submodule update --init tools/build
  - git submodule update --init libs/array
  - git submodule update --init libs/assert
  - git submodule update --init libs/bind
  - git submodule update --init libs/concept_check
  - git submodule update --init libs/config
  - git submodule update --init libs/container
  - git submodule update --init libs/core
  - git submodule update --init libs/detail
  - git submodule update --init libs/endian
  - git submodule update --init libs/functional
  - git submodule update --init libs/function_types
  - git submodule update --init libs/fusion
  - git submodule update --init libs/integer
  - git submodule update --init libs/iterator
  - git submodule update --init libs/lexical_cast
  - git submodule update --init libs/math
  - git submodule update --init libs/move
  - git submodule update --init libs/mpl
  - git submodule update --init libs/numeric/conversion
  - git submodule update --init libs/optional
  - git submodule update --init libs/phoenix
  - git submodule update --init libs/pool
  - git submodule update --init libs/predef
  - git submodule update --init libs/preprocessor
  - git submodule update --init libs/proto
  - git submodule update --init libs/range
  - git submodule update --init libs/regex
  - git submodule update --init libs/smart_ptr
  - git submodule update --init libs/static_assert
  - git submodule update --init libs/throw_exception
  - git submodule update --init libs/tti
  - git submodule update --init libs/tuple
  - git submodule update --init libs/type_index
  - git submodule update --init libs/typeof
  - git submodule update --init libs/type_traits
  - git submodule update --init libs/unordered
  - git submodule update --init libs/utility
  - git submodule update --init libs/variant

  - rm -rf libs/spirit
  - mkdir libs/spirit
  - cp -r $TRAVIS_BUILD_DIR/* libs/spirit

  - ./bootstrap.sh
